#define _MI_
#include "archdep.h"


        .word $7400
        * = $7400

l7400   jmp l8c9e

_bitmapSkull
	.byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$03
	.byt $00,$00,$00,$07,$1f,$7f,$ff,$ff,$07,$3f,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$80,$f0,$fc,$ff,$ff,$ff,$ff,$ff
	.byt $00,$00,$00,$80,$c0,$f0,$fc,$ff,$00,$00,$00,$00,$00,$00,$00,$00
	.byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
	.byt $03,$0f,$0f,$1f,$3f,$7f,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $80,$c0,$e0,$f0,$f0,$fc,$fe,$fe,$00,$00,$00,$00,$00,$00,$00,$00
	.byt $01,$01,$02,$03,$07,$07,$07,$0f,$7f,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$fe,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $00,$80,$80,$c0,$c0,$c0,$c0,$c0,$0f,$0f,$0f,$0f,$0f,$1f,$1f,$1f
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$e0,$e0,$e0,$e0,$e0,$e0,$c0,$c0
	.byt $1f,$1f,$1f,$0f,$0f,$0f,$0f,$0f,$ff,$ff,$ff,$ff,$fe,$f8,$f0,$f0
	.byt $ff,$ff,$f8,$80,$00,$00,$00,$00,$ff,$ff,$7f,$3f,$1f,$17,$0f,$0f
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$fc,$f0,$e0,$e0,$e0,$e0,$c0
	.byt $ff,$7f,$01,$00,$00,$00,$00,$00,$ff,$ff,$ff,$7f,$7f,$1f,$1f,$1f
	.byt $c0,$c0,$c0,$80,$80,$80,$80,$80,$07,$07,$07,$07,$07,$03,$03,$03
	.byt $f0,$e0,$e0,$e0,$e0,$e0,$f0,$f0,$00,$00,$00,$00,$00,$00,$00,$00
	.byt $03,$07,$07,$07,$0f,$1f,$7f,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $c0,$c0,$c0,$c0,$c0,$e0,$f0,$f8,$00,$00,$00,$00,$00,$00,$00,$00
	.byt $1f,$1f,$1f,$1f,$1f,$1f,$3f,$3f,$80,$80,$80,$c0,$c0,$c0,$c0,$c0
	.byt $03,$03,$03,$03,$03,$03,$03,$03,$f0,$f8,$fc,$fe,$ff,$ff,$ff,$ff
	.byt $01,$07,$0f,$1f,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$fe,$fe,$fc,$fc,$f8
	.byt $b7,$83,$03,$01,$01,$00,$00,$00,$fe,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $00,$80,$e0,$ff,$ff,$ff,$ff,$ff,$3f,$7f,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $c0,$c0,$c0,$c0,$c0,$c0,$c0,$80,$03,$03,$01,$01,$01,$00,$00,$00
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$7f,$7f,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $f8,$f8,$f0,$f0,$f8,$f8,$ff,$ff,$00,$00,$00,$00,$00,$a1,$ff,$ff
	.byt $7f,$7f,$7f,$7f,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ff,$ff,$ff,$ff,$fe,$fe,$fc,$78,$80,$80,$00,$00,$00,$00,$00,$00
	.byt $00,$00,$00,$00,$00,$00,$00,$00,$3f,$3f,$1e,$1f,$0f,$0f,$0f,$07
	.byt $ff,$f7,$cf,$cf,$cf,$c7,$c7,$cf,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$fb
	.byt $ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $ef,$e1,$f1,$f1,$f3,$f3,$f3,$f7,$f8,$f0,$f0,$e0,$e0,$e0,$e0,$e0
	.byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
	.byt $07,$07,$07,$07,$07,$03,$03,$03,$ff,$fb,$eb,$fb,$ff,$fd,$fa,$fa
	.byt $ef,$52,$52,$52,$e2,$7e,$e7,$a4,$79,$79,$11,$11,$11,$17,$fc,$92
	.byt $ff,$35,$01,$05,$15,$7f,$cd,$4d,$ff,$9f,$af,$bf,$bf,$ff,$ef,$5f
	.byt $e0,$e0,$e0,$e0,$c0,$c0,$c0,$c0,$00,$00,$00,$00,$00,$00,$00,$00
	.byt $00,$00,$00,$00,$00,$00,$00,$00,$03,$01,$01,$00,$00,$00,$00,$00
	.byt $ff,$ff,$ff,$ff,$7f,$7f,$3f,$1f,$a4,$ec,$ff,$ff,$ff,$ff,$ff,$ff
	.byt $96,$96,$97,$ef,$ff,$ff,$ff,$ff,$49,$cb,$cf,$7f,$ff,$ff,$ff,$ff
	.byt $7f,$ff,$ff,$ff,$fe,$fc,$f8,$f0,$80,$80,$00,$00,$00,$00,$00,$00
	.byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
	.byt $00,$00,$00,$00,$00,$00,$00,$00,$0f,$07,$03,$00,$00,$00,$00,$00
	.byt $ff,$ff,$ff,$ff,$3f,$0f,$00,$00,$ff,$ff,$ff,$ff,$ff,$ff,$00,$00
	.byt $ff,$ff,$ff,$fe,$fc,$f0,$00,$00,$e0,$c0,$80,$00,$00,$00,$00,$00
	.byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00

l7763
strTableRace
        .aasc "lizar",$e4
        .aasc "huma",$ee
        .aasc "el",$e6
        .aasc "dwar",$e6
        .aasc "bobbi",$f4
strTableLongWeapons
l777c
        .aasc "hand",$f3
        .aasc "dagge",$f2
        .aasc "mac",$e5
        .aasc "ax",$e5
        .aasc "rope & spike",$f3
        .aasc "swor",$e4
        .aasc "great swor",$e4
        .aasc "bow & arrow",$f3
        .aasc "amule",$f4
        .aasc "wan",$e4
        .aasc "staf",$e6
        .aasc "triangl",$e5
        .aasc "pisto",$ec
        .aasc "light swor",$e4
        .aasc "phazo",$f2
        .aasc "blaste",$f2
strTableWeapon
l77ec
        .aasc "hand",$f3
        .aasc "dagge",$f2
        .aasc "mac",$e5
        .aasc "ax",$e5
        .aasc "rop",$e5
        .aasc "swor",$e4
        .aasc "g swor",$e4
        .aasc "bo",$f7
        .aasc "amule",$f4
        .aasc "wan",$e4
        .aasc "staf",$e6
        .aasc "triangl",$e5
        .aasc "pisto",$ec
        .aasc "l swor",$e4
        .aasc "phazo",$f2
        .aasc "blaste",$f2
_strTableAttributes
l7842
        .aasc "Hit point",$f3
        .aasc "Strengt",$e8
        .aasc "Agilit",$f9
        .aasc "Stamin",$e1
        .aasc "Charism",$e1
        .aasc "Wisdo",$ed
        .aasc "Intelligenc",$e5
        .aasc "Gol",$e4
        .aasc "Rac",$e5
        .aasc "Typ",$e5
_strTableSpell
        .aasc "Praye",$f2
        .aasc "Ope",$ee
        .aasc "Unloc",$eb
        .aasc "Magic Missil",$e5
        .aasc "Stea",$ec
        .aasc "Ladder Dow",$ee
        .aasc "Ladder U",$f0
        .aasc "Blin",$eb
        .aasc "Creat",$e5
        .aasc "Destro",$f9
        .aasc "Kil",$ec
strTableArmour
l78d4
        .aasc "ski",$ee
        .aasc "leather armou",$f2
        .aasc "chain mai",$ec
        .aasc "plate mai",$ec
        .aasc "vacuum sui",$f4
        .aasc "reflect sui",$f4
l7911
_strTableClass
        .aasc "peasan",$f4
        .aasc "fighte",$f2
        .aasc "cleri",$e3
        .aasc "wizar",$e4
        .aasc "thie",$e6
_strTableTransport
l7930
        .aasc "foo",$f4
        .aasc "hors",$e5
        .aasc "car",$f4
        .aasc "raf",$f4
        .aasc "frigat",$e5
        .aasc "airca",$f2
        .aasc "shuttl",$e5
        .aasc "phanto",$ed
        .aasc "star cruise",$f2
        .aasc "battle bas",$e5
        .aasc "time machin",$e5
_strTableDirection
_strTableCommands
l797f
        .aasc "Nort",$e8
        .aasc "Sout",$e8
        .aasc "Eas",$f4
        .aasc "Wes",$f4
        .aasc "Pas",$f3
        .aasc "Attack",$a0
        .aasc "Board",$a0
        .aasc "Cast",$a0
        .aasc "Dro",$f0
        .aasc "Ente",$f2
        .aasc "Fire",$a0
        .aasc "Ge",$f4
        .aasc "HyperJum",$f0
        .aasc "Inform and searc",$e8
        .aasc "K-lim",$e2
        .aasc "Nois",$e5
        .aasc "Ope",$ee
        .aasc "Quit- saving game..",$ae
        .aasc "Ready Weapon,Armour,Spell:",$a0
        .aasc "Stea",$ec
        .aasc "Transac",$f4
        .aasc "Unloc",$eb
        .aasc "Vie",$f7
        .aasc "X-i",$f4
        .aasc "Ztat",$f3
_strTableGems
l7a30
        .aasc "Red Ge",$ed
        .aasc "Green Ge",$ed
        .aasc "Blue Ge",$ed
        .aasc "White Ge",$ed

l7a51
        .byt $0a,$05,$04,$03,$02,$01,$04,$06,$08,$0a,$01,$02,$04,$06,$08
        l7a69 = * + 9
        l7a6a = * + 10
        l7a6f = * + 15
        .byt $02,$04,$06,$08,$09,$0a,$02,$02,$03,$03,$03,$04,$04,$04,$05,$05
        .byt $05,$06,$06,$06,$07,$07,$07,$08,$08,$08,$09,$09,$09,$0a,$0a
        .asc " "
        .asc "     "
l7a85
        .aasc "Ness creatur",$e5
        .aasc "giant squi",$e4
        .aasc "dragon turtl",$e5
        .aasc "pirate shi",$f0
        .aasc "hoo",$e4
        .aasc "bea",$f2
        .aasc "hidden arche",$f2
        .aasc "dark knigh",$f4
        .aasc "evil tren",$f4
        .aasc "thie",$e6
        .aasc "or",$e3
        .aasc "knigh",$f4
        .aasc "necromance",$f2
        .aasc "evil range",$f2
        .aasc "wandering warloc",$eb
        .aasc "range",$f2
        .aasc "skeleto",$ee
        .aasc "thie",$e6
        .aasc "giant ra",$f4
        .aasc "ba",$f4
        .aasc "giant spide",$f2
        .aasc "vipe",$f2
        .aasc "or",$e3
        .aasc "cyclop",$f3
        .aasc "gelatinous cub",$e5
        .aasc "etti",$ee
        .aasc "mimi",$e3
        .aasc "lizard ma",$ee
        .aasc "minotau",$f2
        .aasc "carrion creepe",$f2
        .aasc "tangle",$f2
        .aasc "gremli",$ee
        .aasc "wandering eye",$f3
        .aasc "wrait",$e8
        .aasc "lic",$e8
        .aasc "invisible seeke",$f2
        .aasc "mind whippe",$f2
        .aasc "zor",$ee
        .aasc "daemo",$ee
        .aasc "balro",$ee
; strTableLands
l7bda
        .aasc "Lord Britis",$e8
        .aasc "the Feudal Lord",$f3
        .aasc "the Dark Unknow",$ee
        .aasc "Danger and Despai",$f2

locationsLatitude
l7c18
        .byt $1f,$14,$03,$02,$06,$24,$16,$35    ; continent 0
        .byt $1e,$04,$2a,$0f,$3d,$20,$22,$36
        .byt $15,$38,$1b,$38,$0f

        .byt $5e,$56,$7b,$5a,$48,$43,$5d,$71    ; continent 1
        .byt $53,$66,$74,$6b,$5c,$5d,$78,$4f
        .byt $64,$6a,$48,$7c,$76

        .byt $a1,$a9,$84,$a5,$b7,$bc,$8e,$a2    ; continent 2
        .byt $ac,$99,$8b,$94,$a3,$a2,$87,$b0
        .byt $9b,$95,$b7,$83,$89

        .byt $df,$d4,$c3,$c2,$c6,$e4,$d6,$f5    ; continent 3
        .byt $de,$c4,$ea,$cf,$fd,$e0,$e2,$f6
        .byt $d5,$f8,$db,$f8,$cf

locationsLongitude
l7c6c
        .byt $1e,$16,$3b,$1a,$08,$03,$31,$1d    ; continent 0
        .byt $13,$26,$34,$2b,$1c,$1d,$38,$0f
        .byt $24,$2a,$08,$3c,$36

        .byt $1f,$14,$03,$02,$06,$24,$35,$16    ; continent 1
        .byt $1e,$04,$2a,$0f,$3d,$20,$22,$36
        .byt $15,$38,$1b,$38,$0f

        .byt $1f,$14,$03,$02,$06,$24,$16,$35    ; continent 2
        .byt $1e,$04,$2a,$0f,$3d,$20,$22,$36
        .byt $15,$38,$1b,$38,$0f

        .byt $21,$29,$04,$25,$37,$3c,$0e,$22    ; continent 3
        .byt $2c,$19,$0b,$14,$23,$22,$07,$30
        .byt $1b,$15,$37,$03,$09

strTablePlaces
l7cc0
        .aasc "The Castle of Lord Britis",$e8
        .aasc "The Castle of the Lost Kin",$e7
        .aasc "The Tower of Knowledg",$e5
        .aasc "The Pillars of Protectio",$ee
        .aasc "The Dungeon of Perini",$e1
        .aasc "The Lost Cavern",$f3
        .aasc "The Mines of Mt. Dras",$e8
        .aasc "The Mines of Mt. Drash I",$c9
        .aasc "Mondain's Gate to Hel",$ec
        .aasc "The Unholy Hol",$e5
        .aasc "The Dungeon of Doub",$f4
        .aasc "The Dungeon of Monto",$f2
        .aasc "Death's Awakenin",$e7
        .aasc "Britai",$ee
        .aasc "Moo",$ee
        .aasc "Faw",$ee
        .aasc "Paw",$f3
        .aasc "Monto",$f2
        .aasc "Ye",$f7
        .aasc "Tun",$e5
        .aasc "Gre",$f9

        .aasc "The Castle Baratari",$e1
        .aasc "The Castle Rondorli",$ee
        .aasc "The Pillar of Ozymandia",$f3
        .aasc "The Pillars of the Argonaut",$f3
        .aasc "Scorpion Hol",$e5
        .aasc "The Savage Plac",$e5
        .aasc "The Horror of the Harpie",$f3
        .aasc "The Horror of the Harpies I",$c9
        .aasc "Advari's Hol",$e5
        .aasc "The Labyrint",$e8
        .aasc "The Gorgon's Hol",$e5
        .aasc "Where Hercules Die",$e4
        .aasc "The Dead Warrior's Figh",$f4
        .aasc "Arnol",$e4
        .aasc "Lind",$e1
        .aasc "Hele",$ee
        .aasc "Owe",$ee
        .aasc "Joh",$ee
        .aasc "Gerr",$f9
        .aasc "Wol",$e6
        .aasc "The Snak",$e5

        .aasc "The Castle of Olympu",$f3
        .aasc "The Black Dragon's Castl",$e5
        .aasc "The Sign Pos",$f4
        .aasc "The Southern Sign Pos",$f4
        .aasc "The Metal Twiste",$f2
        .aasc "The Troll's Hol",$e5
        .aasc "The Viper's Pi",$f4
        .aasc "The Viper's Pit I",$c9
        .aasc "The Guild of Deat",$e8
        .aasc "The End..",$ae
        .aasc "The Tramp of Doo",$ed
        .aasc "The Long Deat",$e8
        .aasc "The Slow Deat",$e8
        .aasc "Nassa",$f5
        .aasc "Clear Lagoo",$ee
        .aasc "Stou",$f4
        .aasc "Gauntle",$f4
        .aasc "Imaginatio",$ee
        .aasc "Ponde",$f2
        .aasc "Wealt",$e8
        .aasc "Poo",$f2

        .aasc "The White Dragon's Castl",$e5
        .aasc "The Castle of Shamin",$ef
        .aasc "The Grave of the Lost Sou",$ec
        .aasc "Eastern Sign Pos",$f4
        .aasc "Spine Breake",$f2
        .aasc "Free Death Hol",$e5
        .aasc "The Dead Cat's Lif",$e5
        .aasc "The Dead Cat's Life I",$c9
        .aasc "The Morbid Adventur",$e5
        .aasc "The Skull Smashe",$f2
        .aasc "Dead Man's Wal",$eb
        .aasc "The Dungeon of Doo",$ed
        .aasc "Hole to Hade",$f3
        .aasc "Gorla",$e2
        .aasc "Dextro",$ee
        .aasc "Magi",$e3
        .aasc "Wheele",$f2
        .aasc "Bulldoze",$f2
        .aasc "The Brothe",$f2
        .aasc "The Turtl",$e5
        .aasc "Lost Friend",$f3

l8175   bcc l818e
        jsr print
        .aasc $7d,"Disk error ",$00
        jsr l8b64
        jsr $164f
        sec
l818e   rts

l818f   lda $5c
        bne l8196
l8193   jsr $1646
l8196   lda #$97
        sta Cia2PortA
        lda #$18
        sta VicMemCtrlReg
        lda #$00
        sta $5c
        sta $5d
        rts
l81a7   l81ad = * + 6
        .byt $00,$28,$00,$18,$00,$00,$00,$2f,$55
l81b0   and ($2e),y
        bvc l8200
        l81c3 = * + 15
        .asc ""

        .byt $41,$59,$45,$52,$2f,$55,$31,$2e,$56,$41,$52,$53,$00,$00,$00,$00
l81c4   l81c5 = * + 1
        .byt $00,$05
l81c6   l81c7 = * + 1
; Instruction opcode accessed.
        bvc l81c8
l81c8
        .byt $00

commandKeys
l81c9
        ; allowed commands
        .aasc "@/;: ABCDEFGHIKNOQRSTUVXZ"

; stats
l81e2
        .word $01ca             ; length of stats file
l81e4
        .byt $00                ; continent
        .byt $00                ; continent << 6
        .byt $ff

statsNoiseOn
        .byt $ff
l81e8   l81ea = * + 2
        jsr $0020
        l81ee = * + 3
        l81ef = * + 4
        l81f0 = * + 5
        l81f1 = * + 6
        .byt $00,$00,$00
statsSpell
        .byt $00
statsWeapon
        .byt $00
statsArmour
        .byt $00
statsTransport
        .byt $00
invArmour
l81f2   ora ($01,x)
        ora ($01,x)
        ora ($01,x)
invWeapons
l81f8   ora ($01,x)
        ora ($01,x)
        ora ($01,x)
        ora ($01,x)
l8200   ora ($01,x)
        ora ($01,x)
        ora ($01,x)
        ora ($01,x)

invSpells
invPrayer
l8208   ora ($03,x)
        l8213 = * + 9
        .byt $03,$03,$00,$03,$03,$03,$03,$03,$03,$01,$01,$01,$01,$01,$01,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$ff,$ff,$ff,$ff
        l822b = * + 1
        .byt $00,$00
statsGender
l822c   l822d = * + 1
; Instruction opcode accessed.
        ora ($47,x)
        jmp ($6e69)
        .byt $64,$61,$00,$00,$00,$00,$00,$00,$00,$00

statsHp
l823b
        .word $0384
        .byt $5a,$00,$5a,$00
        l824b = * + 10
        l824d = * + 12
        l824f = * + 14
        l8250 = * + 15
        .byt $0f,$00,$0f,$00,$32,$00,$0f,$00
statsCoin
l8249
        .word $0838
statsRace
        .byt $02
        .byt $00
statsClass
        .byt $02
        .byt $00,$00,$00
        l825c = * + 11
        l825d = * + 12
        .byt $00,$00,$00,$00,$00,$00,$00,$00
l8259
        .byt $95

statsFood
l825a
        .word $0059
        .byt $37,$02
        .asc "h"
        .byt $03
        .asc "h"
        .byt $03,$00,$ff
        .asc "o>"
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
        .byt $00,$00,$00,$00,$00,$00,$00,$00,$00,$00,$00
l83ac   inc l83b5
        bne l83b4
l83b1   inc l83b6
l83b4   l83b5 = * + 1
        l83b6 = * + 2
        lda $0200
        rts

l83b8   l83b9 = * + 1
; Instruction parameter accessed.
        l83ba = * + 2
; Instruction parameter accessed.
        lda $0200
        inc l83b9
        bne l83c3
l83c0   inc l83ba
l83c3   rts

printTwoDigits
l83c4   pha
        lsr
        lsr
        lsr
        lsr
        jsr printDigit          ; print upper nibble digit
        pla                     ; then print lower nibble digit ...

printDigit
l83cd   and #$0f                ; mask low nibble
        ora #$30                ; convert to ASCII digit '0'...
        cmp #$3a                ; digit '0'..'9'?
        bcc printChar           ; yes -> print it
        adc #$06                ; else convert to hex character 'A'...'F'

printChar
l83d7   jsr drawChar
        inc zpCursorCol
_printCharEnd
        rts


l83dd   and #$7f
        cmp #LF
        bcc printChar
l83e3   beq l83fe
l83e5   cmp #$7e
        beq l83f3
l83e9   cmp #$7d
        bne _printCharEnd
l83ed   lda zpCursorCol
        cmp #$02
        bcc l83f6
l83f3   jsr l83fe

l83f6   lda #$01
        sta zpCursorCol
        rts

l83fb   jsr $164f

l83fe   inc zpCursorRow
        lda zpCursorRow
        cmp zpWndBtm
        bcc printCR
l8406   tya
        pha
        txa
        pha
        jsr $1649
l840d   pla
        tax
        pla
        tay

printCR
l8411   lda #$00
        sta zpCursorCol         ; return cursor to begin of line
        rts

l8416   inc zpWndTop
        dec zpWndBtm
        inc zpWndLeft
        dec zpWndWdth
        dec zpWndWdth
        lda zpWndTop
        sta zpCursorRow
        bne printCR

printFromTableCap
l8426   sec
        ror l81ad               ; capitalize output string
        .byt $2c                ; bit !$00a2

printFirstFromTable
l842b
        ldx #$00                ; print first string from string table

printFromTable
l842d   pla
        sta l83b5               ; set data pointer to data after RTS call
        pla
        sta l83b6
        jsr l83ac               ; read data byte
        sta l83b9
        jsr l83ac               ; read data byte
        sta l83ba
        lda l83b6               ; update return address
        pha
        lda l83b5
        pha

        txa
        beq l8455
l844c   jsr l83b8
l844f   asl
        bcc l844c
l8452   dex
        bne l844c

l8455   jsr l83b8               ; read character from object table
        cmp #$7f                ; newline?
        beq l847f
        pha
        bit l81ad               ; capitalize this character?
        bpl l8475               ; no ->
        and #$7f
        cmp #$7c
        bcs l8475
        cmp #$61                ; 'a'
        bcc l8472
        cmp #$7b                ; 'z'+1
        bcs l8472
        eor #$20                ; convert to upper case letter
l8472   sta l81ad
l8475   jsr l83dd               ; print character
l8478   pla
        bpl l8455               ; more characters in string?
l847b   lsr l81ad
        rts

l847f   jsr l83b8
l8482   clc
        adc zpCursorCol
        sta zpCursorCol
        jmp l8455

printAtPos
l848a   stx zpCursorCol
        sty zpCursorRow

print
l848e   pla
        sta l83b5
        pla
        sta l83b6
l8496   jsr l83ac
l8499   beq l84b0
l849b   cmp #$7f
        beq l84a5
l849f   jsr l83dd
l84a2   jmp l8496
l84a5   jsr l83ac
l84a8   clc
        adc zpCursorCol
        sta zpCursorCol
        jmp l8496
l84b0   lda l83b6
        pha
        lda l83b5
        pha
        rts

printRepeatChar
l84b9   jsr printChar
l84bc   dex
        bne printRepeatChar
l84bf   rts

printBoard
l84c0   jsr setTextFull         ; set full text window, home
        jsr $1652
l84c6   jsr setTextFull         ; set full text window, home
        lda #$10                ; char: upper left corner of frame
        jsr printChar
        ldx #38                 ; # of repeats: 38
        lda #$04                ; char: upper border
        jsr printRepeatChar     ; print upper border
        lda #$12                ; char: upper right corner
        jsr drawChar
_printBoardL1
l84da   inc zpCursorRow
        jsr printCR
l84df   lda #$0a                ; char: left border
        jsr drawChar
l84e4   lda #39
        sta zpCursorCol
        lda #$08                ; char: right border
        jsr drawChar
        jsr $1673
        lda zpCursorRow
        eor #18                 ; repeat 18 times
        bne _printBoardL1
        sta zpCursorCol
        inc zpCursorRow
        lda #$04
        jsr printChar
l84ff   ldx #38
        lda #$06
        jsr printRepeatChar
l8506   lda #$04
        jsr drawChar
l850b   lda #30
        sta zpCursorCol
        lda #$02
        jsr drawChar
        lda #12
l8516   inc zpCursorRow
        jsr drawChar
        ldx zpCursorRow
        cpx #23
        bcc l8516
        rts

convertToBcd16
l8522   stx $3f                 ; value: lb
        sta $40                 ; value: hb
        ldx #$00
        stx zpValue1e0          ; BCD value x 1e0
        stx zpValue1e2          ; BCD value x 1e2
        stx zpValue1e4          ; BCD value x 1e4
        stx _addX1e4
        stx _addX1e2
        inx
        stx _addX1e0
        sed                     ; use decimal addition!
_convrtToBcd16L1
        lsr $40
        ror $3f
        bcc _convrtToBcd16J1    ; carry not set? ->
        clc                     ; else add bcd multiplier
        lda zpValue1e0
        adc _addX1e0            ; add decimal multipliers
        sta zpValue1e0
        lda zpValue1e2
        adc _addX1e2
        sta zpValue1e2
        lda zpValue1e4
        adc _addX1e4
        sta zpValue1e4
_convrtToBcd16J1
        clc
        lda _addX1e0            ; duplicate multipliers
        adc _addX1e0
        sta _addX1e0
        lda _addX1e2
        adc _addX1e2
        sta _addX1e2
        lda _addX1e4
        adc _addX1e4
        sta _addX1e4
        lda $3f                 ; finished converting?
        ora $40
        bne _convrtToBcd16L1    ; no ->
        cld                     ; clear decimal flag
        rts

_addX1e0
l8579
        .byt $01
_addX1e2
        .byt $00
_addX1e4
        .byt $00

l857c   jsr convertToBcd16
l857f   inx
        bne l8588
l8582   tax
        lda #$00
        jsr convertToBcd16
l8588   sta l85bd
        jmp l8597
l858e   lda zpValue1e0,x        ; get BCD value
        lsr                     ; isolate upper digit
        lsr
        lsr
        lsr
        jsr l85a6               ; print upper digit
l8597   txa
        bne l859d
l859a   inc l85bd
l859d   lda zpValue1e0,x        ; get BCD value
        jsr l85a6               ; print lower digit
l85a2   dex
        bpl l858e
l85a5   rts

l85a6   and #$0f
        bne l85b7
l85aa   cmp l85bd
        bne l85ba
l85af   lda l85be
        beq l85a5
l85b4   jmp printChar
l85b7   sta l85bd
l85ba   jmp printDigit
l85bd   l85be = * + 1
        .byt $00,$00
l85bf   ldy #$ff
        sec
l85c2   iny
        sbc #$0a
        bcs l85c2
l85c7   tya
        rts
l85c9   sta $43
        jsr randomNumber
l85ce   cmp $43
        bcc l85d6
l85d2   sbc $43
        bcs l85ce
l85d6   cmp #$00
        sta $43
        rts
l85db   jsr $1673
l85de   lda $56
        rts
l85e1   jsr l8777
l85e4   ldy #$3d
        sty l85fc
l85e9   jsr $1ed5
l85ec   nop
        nop
        nop
        cmp #$00
        bne l85fb
l85f3   jsr $16a0
l85f6   dec l85fc
        bne l85e9
l85fb   rts
l85fc   .asc ""
        .byt $40


checkCommandKey
l85fd   ldx #24                 ; iterate over command keys
_checkCmdKeyL1
        cmp commandKeys,x       ; valid command?
        beq _checkCmdKeyJ1      ; yes ->
        dex
        bpl _checkCmdKeyL1

        jsr print               ; illegal command key...
        .aasc "Huh?",$00
        jsr l8772
        sec
        rts
_checkCmdKeyJ1
        txa                     ; command index
        pha                     ; store
        cmp #$04                ; direction command?
        bcs _checkCmdKeyJ2      ; no ->
        lda l81c8
        beq _checkCmdKeyJ2      ; print "North/South/East/West"
        sta l862c
        lda l81c7
        sta l862b
        jsr printFromTable      ; print "Forward/Turn around/Turn right/Turn left"
l862b   l862c = * + 1
        .word _strTableCommands
        jmp _checkCmdKeyJ3

_checkCmdKeyJ2
        jsr printFromTable     ; print the command
        .word _strTableCommands
_checkCmdKeyJ3
        pla                     ; restore command id
        asl                     ; as 16 bit index
        tax
        clc
        rts

l863a   clc
        bcs l8675
l863d   sty l81c5
        sta l81c6
        bcc l864a
l8645   lda #$00
        jsr $1685
l864a   sed
        sec
        lda l8259
        sbc l81c5
        sta l8259
        bcs l866a
l8657   lda statsFood
        ora statsFood+1
        beq l866a
l865f   lda statsFood
        bne l8667
l8664   dec statsFood+1
l8667   dec statsFood
l866a   clc
        lda l824f
        adc l81c6
        sta l824f
        l8675 = * + 1
        bcs l8678
l8676   cld
        rts
l8678   sed
        sec
        ldx #$00
l867c   lda l8250,x
        adc #$00
        sta l8250,x
        inx
        bcs l867c
l8687   cld
        rts

l8689   jsr l870c
        jsr setTextStatus       ; set text window for status, home
        jsr print
        .aasc "Hits ",$7c
        .aasc "Food ",$7c
        .aasc "Exp. ",$7c
        .aasc "Coin ",$00
        jmp l86c9

l86ad   cmp #1                  ; high byte >= 1?
        bcs l86bb               ; yes ->
        cpx #100                ; low byte >= 100
        bcs l86bb               ; yes ->
        pha                     ; store hb
        lda #$ff                ; reverse flag on
        sta zpInverse
        pla                     ; restore hb
l86bb   jsr l857c
        jsr l83fb
        lda #$00
        sta zpInverse           ; reverse flag off
        rts

l86c6   jsr l870c

l86c9   jsr setTextStatus
l86cc   sta l85be
        lda #36
        sta zpWndLeft
l86d3   lda #4
        sta zpWndWdth
        lda statsHp+1           ; hit points
        ldx statsHp
        jsr l86ad
l86e0   lda statsFood+1         ; food
        ldx statsFood
        jsr l86ad
l86e9   lda l825d               ; exp
        ldx l825c
        jsr l857c
        jsr l83fb
l86f5   lda statsCoin+1
        ldx statsCoin
        jsr l857c               ; print amount: coin
l86fe   jsr $164f

l8701   ldx #$05
l8703   lda l81a7,x
        sta zpWndLeft,x
        dex
        bpl l8703
l870b   rts

l870c   ldx #$05
l870e   lda zpWndLeft,x
        sta l81a7,x
        dex
        bpl l870e
l8716   rts

l8717   ldx statsSpell
        jsr printFromTable
        .word _strTableSpell
        rts

_skipBackLeftBlanks
l8720   lda zpCursorRow
        asl
        asl
        asl
        tax
l8726   ldy zpCursorCol
        beq l874d
l872a   dey
        lda bmpLinePtrLb,x
        clc
        adc bmpColOffLb,y
        sta $36
        lda bmpLinePtrHb,x
        eor $5c
        adc bmpColOffHb,y
        sta $37
        ldy #$07
        lda #$00
l8742   ora ($36),y
        bne l874d
l8746   dey
        bpl l8742
l8749   dec zpCursorCol
        bne l8726
l874d   rts

l874e   jsr print
        .aasc $7d
        .aasc "Hmmmm... no effect?",$00

l8766   lda #$08
        bne l8774

cmdInvalid
l876a   jsr _skipBackLeftBlanks
        lda #$3f                ; '?'
        jsr drawChar

l8772   lda #$10
l8774   jsr playSoundEffect
l8777   nop
        nop
        nop
        jsr GETIN
l877d   cmp #$00
        bne l8777
l8781   lda #$00
        sta $5b
        sta $56
        rts

l8788   jsr l870c
l878b   lda #4                  ; set up transaction window
        sta zpWndTop
        sta zpWndLeft
        lda #16
        sta zpWndBtm
        lda #32
        sta zpWndWdth
        jsr $1652
l879c   jsr l83f3
l879f   lda #$60
        jsr $168b
l87a4   jsr l87c9
l87a7   ldx #4                  ; draw transaction window border
        ldy #18
        stx zpX0                ; P0 = (4,18)
        sty zpY0
        ldx #250                ; P1 = (250,18)
        jsr drawLineTo          ; draw line P0 to P1
        ldx zpX0                ; P0 = (250,18)
        ldy #109                ; P1 = (250,109)
        jsr drawLineTo          ; draw line P0 to P1
        ldx #4                  ; P0 = (250,109)
        ldy zpY0                ; P1 = (4, 109)
        jsr drawLineTo          ; draw line P0 to P1
        ldx zpX0                ; P0 = (4,109)
        ldy #18                 ; P1 = (4,18)
        jsr drawLineTo          ; draw line P0 to P1
l87c9   lda $5c
        eor $5d
        sta $5c
        rts

cmdReady
l87d0   pha
        lda #7
        sta zpCursorCol
        pla
        ldx #$03
_cmdReadyL1
        cmp _readyKeyCodes-1,x  ; "SWA" (Spell, Weapon, Armour)
        beq _cmdReadyJ1
        dex
        bne _cmdReadyL1
_cmdReadyJ1
        txa                     ; ready command ID
        asl                     ; as 16 bit offset
        tay
        lda _cmdReadySubFct+1,y
        pha                     ; -> RTS address
        lda _cmdReadySubFct,y
        pha
        jsr printFromTable
        .word strTableReady     ; "nothing", "spell:", "weapon:", "armour:"
        jsr $164f
        inc zpCursorCol
_readyNothing
l87f5   rts                     ; -> rts/jump to specific ready <item> routine
_readyKeyCodes
        .aasc "SWA"

_cmdReadySubFct
l87f9
        .word _readyNothing-1
        .word _readySpell-1
        .word _readyWeapon-1
        .word _readyArmour-1

_readySpell
l8801
        lda statsSpell
        jsr _readySelectItem
        .byt 10
        .word invSpells
        .word _strTableSpell
        sta statsSpell
        rts

_readyWeapon
l8810   lda statsWeapon
        jsr _readySelectItem
        .byt 15                 ; # of choices: 15
        .word invWeapons
        .word strTableLongWeapons
        sta statsWeapon
        rts

_readyArmour
l881f   lda statsArmour
        jsr _readySelectItem
        .byt 5
        .word invArmour
        .word strTableArmour
        sta statsArmour
        rts

strTableReady
l882e
        .aasc "nothin",$e7
        .aasc "spell",$ba
        .aasc "weapon",$ba
        .aasc "armour",$ba

_readySelectItem
l8849   sta $46
        pla
        sta l83b5
        pla
        sta l83b6
        jsr l83ac               ; fetch parameter byte
l8856   sta l890b               ; number of selections
        jsr l83ac               ; fetch parameter byte
l885c   sta $41                 ; inventory pointer
        jsr l83ac               ; fetch parameter byte
l8861   sta $42
        jsr l83ac               ; fetch parameter byte
l8866   sta l8907               ; string table pointer
        jsr l83ac               ; fetch parameter byte
l886c   sta l8908
        lda l83b6
        pha
        lda l83b5
        pha
        jsr l870c
l887a   jsr $165e
l887d   ldx #$0e
        ldy #$00
        lda $5d
        sta l81c3
        sty $5d
        jsr printAtPos
        .aasc $0e," Ready ",$18,$00
l8895   jsr $1652
l8898   ldy l890b
        ldx #$01
l889d   lda ($41),y
        beq l88a2
l88a1   inx
l88a2   dey
        bne l889d
l88a5   stx $43
        sec
        lda #$14
        sbc $43
        lsr
        sta zpCursorRow
l88af   lda #$61                ; 'a'
        sta _itemChar           ; character used for item selection
        ldy #$00
l88b6   tya
        pha                     ; store item type index
        lda #13
        sta zpCursorCol
        jsr print
_itemChar
        .aasc "a) ",$00
        pla                     ; restore item type index
        jsr l8902
        tay
        inc zpCursorRow
l88ca   cpy l890b
        bcs l88d9
        inc _itemChar
        iny
        lda ($41),y             ; item in inventory?
        bne l88b6               ; yes ->
        beq l88ca               ; no ->

l88d9   jsr l8701
l88dc   lda l81c3
        sta $5d
        jsr $1664
l88e4   jsr readKey
l88e7   pha
        jsr l8ad6
l88eb   sec
        pla
        sbc #$41                ; 'A'; make 0-based index
        beq l8902
l88f1   bmi l88ff
l88f3   cmp l890b               ; valid selection?
        bcc l88fa               ; yes ->
        bne l88ff
l88fa   tay
        lda ($41),y             ; item in inventory?
        bne l8901               ; yes ->
l88ff   ldy $46
l8901   tya

l8902   tax
        pha
        jsr printFromTableCap
l8907   l8908 = * + 1
        .byt $00,$00
l8909   pla
        rts
l890b   .byt $0a

ztats
l890c   jsr $1661
        jsr l870c
        jsr $165e
        jsr l8416
        ldx #$0c
        ldy #$00
        sty l85be
        lda $5d
        sta l81c3
        sty $5d
        jsr printAtPos
        .aasc $0e," Inventory ",$18,LF,LF
        .aasc "Player: ",$00
        jsr $8ba1
        jsr print
        .aasc LF
        .aasc "A level ",$00
        ldx l825c
        lda l825d
        jsr convertToBcd16
        lda zpValue1e2
        lsr
        lsr
        lsr
        lsr
        clc
        adc #$01
        jsr l8582
        inc zpCursorCol

        lda statsGender         ; gender
        beq _ztatsJ1            ; male? ->
        jsr print
        .aasc "fe",$00
_ztatsJ1
        jsr print
        .aasc "male ",$00
        ldx statsRace           ; race
        jsr printFromTable
        .word strTableRace
        inc zpCursorCol

        ldx statsClass          ; class
        jsr printFromTable
        .word _strTableClass

        jsr l8b10
l8991   dec zpCursorRow
        ldx #$00
        stx l81c4
l8998   stx $46
        txa
        asl
        tay
        ldx statsHp,y
        lda statsHp+1,y
        bne l89a9
l89a5   l89a6 = * + 1
        cpx #$00
        beq l89ae
l89a9   jsr l8b25
        .asc ""
        .byt $42
l89ad   sei
l89ae   ldx $46
        inx
        cpx #$07
        bcc l8998
l89b5   ldx statsCoin
        lda statsCoin+1
        jsr convertToBcd16
l89be   lda zpValue1e0
        and #$0f
        beq l89e0
l89c4   jsr l8adc
l89c7   jsr print
        .aasc "Copper pence....",$00

        lda zpValue1e0
        jsr printDigit
l89e0   lda zpValue1e0
        lsr
        lsr
        lsr
        lsr
        beq l8a04
l89e8   pha
        jsr l8adc
        jsr print
        .aasc "Silver pieces...",$00

        pla
        jsr printDigit
l8a04   lda zpValue1e2
        beq l8a41
l8a08   jsr l8adc
l8a0b   jsr print
        .aasc "Gold Crowns....",$00

        lda zpValue1e2
        cmp #$10
        bcs l8a3e
l8a24   lda #$2e
        jsr printChar
l8a29   lda zpValue1e2
        jsr printDigit
l8a2e   jmp l8a41

l8a31
        .aasc "Enemy vessel",$f3
l8a3e
        jsr printTwoDigits

l8a41   lda l822b
        beq l8a4f
l8a46   ldx #$00
        stx $46
        jsr l8b22
        .word $8a31
l8a4f   lda statsArmour
        sta l81c4
        ldx #$01
l8a57   stx $46
        lda invArmour,x
        beq l8a63
l8a5e   jsr l8b22
        .word strTableArmour
l8a63   ldx $46
        inx
        cpx #$06
        bcc l8a57
l8a6a   lda l81f1
        sta l81c4
        ldx #$01
l8a72   stx $46
        lda l8213,x
        beq l8a7e
l8a79   jsr l8b22
        .word _strTableTransport
l8a7e   ldx $46
        inx
        cpx #$0b
        bcc l8a72
l8a85   ldx #$00
        stx l81c4
l8a8a   stx $46
        lda l81ea,x
        beq l8a96
l8a91   jsr l8b22
        .word _strTableGems
l8a96   ldx $46
        inx
        cpx #$04
        bcc l8a8a
l8a9d   lda statsWeapon
        sta l81c4
        ldx #$01
l8aa5   stx $46
        lda invWeapons,x
        beq l8ab1
        jsr l8b22
        .word strTableLongWeapons
l8ab1   ldx $46
        inx
        cpx #$10
        bcc l8aa5
l8ab8   lda l81ee
        sta l81c4
        ldx #$01
l8ac0   stx $46
        lda invPrayer,x
        beq l8acc
        jsr l8b22
        .word _strTableSpell
l8acc   ldx $46
        inx
        cpx #$0b
        bcc l8ac0
l8ad3   jsr l8b56
l8ad6   jsr l84c6
l8ad9   jmp l8701
l8adc   ldx #$00
        stx zpCursorCol
        ldy zpCursorRow
        iny
        cpy #$12
        bcc l8af5
l8ae7   ldy zpWndTop
        lda #18
        sta zpWndWdth
        adc zpWndLeft
        cmp #$26
        bcs l8af8
l8af3   sta zpWndLeft
l8af5   sty zpCursorRow
l8af7   rts

l8af8   ldx #13
        ldy #18
        jsr printAtPos
        .aasc "more",$00
        jsr l8b56
l8b07   lda #$00
        sta $5d
        inc zpCursorCol
        jsr l870c
l8b10   lda #$05
        sta zpWndTop
        lsr
        sta zpWndLeft
        lda #$24
        sta zpWndWdth
        lda #$13
        sta zpWndBtm
        jmp $1652

l8b22   tax
        lda #$00
l8b25   pha
        txa
        pha
        jsr l8adc
l8b2b   lda #$03
        sta zpCursorCol
        ldx #$09
        lda #$2e
        sta l85be
        jsr printRepeatChar
l8b39   pla
        tax
        pla
        jsr l857c
l8b3f   jsr printCR
l8b42   ldx $46
        lda l81c4
        beq l8b53
l8b49   cpx l81c4
        bne l8b53
l8b4e   lda #$1b
        jsr printChar
l8b53   jmp printFromTableCap
l8b56   lda l81c3
        sta $5d
        jsr $1664
l8b5e   jsr $1646
l8b61   jsr l8701
l8b64   jsr print
        .aasc $7d,"Press Space to continue: ",$00
        jsr l8777
l8b85   jsr readKey
l8b88   cmp #$0d
        beq l8b94
l8b8c   cmp #$1b
        beq l8b94
l8b90   cmp #$20
        bne l8b85
l8b94   jsr $164c
l8b97   inc zpCursorCol
l8b99; Instruction opcode accessed.
        dec zpCursorRow
        jsr l8777
l8b9e   jmp l870c
l8ba1   ldx #$00
l8ba3   lda l822d,x
        beq l8bae
l8ba8   jsr printChar
l8bab   inx
        bne l8ba3
l8bae   rts
        .asc ""
        .byt $60

l8bb0   jsr print
        .aasc " off",$00        ; noise off
        rts

cmdNoise
l8bb9   lda noiseOn
        eor #$ff
        sta noiseOn
        sta statsNoiseOn
        beq l8bb0
        jsr print
        .aasc " on",$00         ; noise on
        rts

l8bce   jsr l83ed
l8bd1   jsr l8ba1
l8bd4   jsr print
        .aasc ", thou art dead.",$00
        jsr $1646
        lda #$00
        sta statsCoin
        sta statsCoin+1
        sta statsFood
        sta statsFood+1
        sta statsHp
        sta statsHp+1
        ldy $5d
        sty l81c3
        sta $5d
        jsr l86c6
l8c09   jsr $1661
        lda #<_bitmapSkull
        sta $60                 ; $60/$61 = $7403
        lda #>_bitmapSkull
        sta $61
        lda #$80
        sta $62
        lda #$25
        eor $5c
        sta $63
        ldx #$0c                ; copy 12*8 raster lines
l8c20   ldy #$47                ; copy 9*8 pixels per row (72)
l8c22   lda ($60),y
        sta ($62),y
        dey
        bpl l8c22
l8c29   lda $60
        clc
        adc #$48
        sta $60
        lda $61
        adc #$00
        sta $61
        lda $62
        clc
        adc #$40
        sta $62
        lda $63
        adc #$01
        sta $63
        dex
        bne l8c20
l8c46   lda #$02
        jsr $1685
l8c4b   lda #$02
        jsr $1685
l8c50   lda l81c3
        sta $5d
        jsr $1664
l8c58   jmp l8777
l8c5b   jsr l8bce

l8c5e   lda #$01

l8c60   ldx #$ff
        txs                     ; reset stack
        cmp #$07
        bcs l8c6a               ; first time: load and start Character Generator
l8c67   tax
        bne l8c74
l8c6a   ldx #$04
        jsr loadFile            ; load "GE",$8c9e
        bcs l8c6a
        jmp l8c9e               ; jump into "GE"

l8c74   clc                     ; second time: start game
        adc #$04                ; 1+4 = 5
        sta l8c97
l8c7a   jsr l8777
l8c7d   ldx l8c97
        jsr loadFile            ; copy $e000 to $8c9e (file OU)
l8c83   jsr l8175
l8c86   bcs l8c7a
l8c88   jsr l818f
l8c8b   jsr l8689
l8c8e   jsr l84c6
l8c91   jsr l8701
l8c94   jmp l8c9e

l8c97   .byt $04
l8c98   jsr $163d
        .byt $4c,$9b,$8c

l8c9e   sei
        ldx #$ff                ; reset stack
        txs
        ldx #$0b
        jsr loadFile            ; load "ST",$0c00
        ldx #$0f
        jsr loadFile            ; load "PR",$12c0
        jsr setTextFull         ; set full text window, home
        jsr $163a
l8cb2   lda #$60
        sta $5c
        sta $5d
        jsr $1664
l8cbb   jsr l818f
l8cbe   lda #$96
        sta Cia2PortA
        lda #$80
        sta VicMemCtrlReg
        lda #$00
        jmp l8c60
        .asc "H"
